<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TapDay PRO 2026 â€“ Telegram Edition</title>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { 
  getFirestore, collection, doc, setDoc, getDoc, updateDoc,
  query, orderBy, limit, onSnapshot, serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

/* ================== FIREBASE CONFIG ================== */
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  projectId: "YOUR_PROJECT",
  storageBucket: "YOUR_PROJECT.appspot.com",
  messagingSenderId: "XXXX",
  appId: "XXXX"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ================== TELEGRAM AUTH ================== */
const TELEGRAM_BOT = "tapday_play_bot"; // Ñ‚Ğ²Ñ–Ğ¹ Ğ±Ğ¾Ñ‚
let telegramUser = JSON.parse(localStorage.getItem("telegramUser")) || null;

async function telegramLogin() {
  if (telegramUser) return;
  const tg = window.Telegram.WebApp || {};
  tg.expand();
  window.TelegramLoginWidget = {
    dataOnauth: function(user){
      telegramUser = user;
      localStorage.setItem("telegramUser",JSON.stringify(user));
      alert(`ĞŸÑ€Ğ¸Ğ²Ñ–Ñ‚ ${user.first_name}!`);
      initPlayer();
    }
  };
}
telegramLogin();

/* ================== PLAYER INIT ================== */
let playerId = localStorage.getItem("playerId");
if(!playerId){
  playerId = "player_"+Math.floor(Math.random()*9999999);
  localStorage.setItem("playerId",playerId);
}

let balance = parseFloat(localStorage.getItem("balance"))||0;
let coins = parseInt(localStorage.getItem("coins"))||0;
let multiplier = 1;
let premium = localStorage.getItem("premium")==="true";

const balanceEl = document.getElementById("balance");
const coinsEl = document.getElementById("coins");
const tapBtn = document.getElementById("tapBtn");
const leaderboardEl = document.getElementById("leaderboard");
const tournamentEl = document.getElementById("tournament");

function updateUI(){
  balanceEl.textContent = `ğŸ’° ${balance.toFixed(2)} $`;
  coinsEl.textContent = `ğŸª™ Coins: ${coins}`;
  localStorage.setItem("balance",balance);
  localStorage.setItem("coins",coins);
}
updateUI();

/* ================== TAP ================== */
tapBtn.onclick = async ()=>{
  balance += 0.01 * multiplier * (premium?2:1);
  updateUI();
  createParticle();
  await sendToServer();
};

/* ================== PARTICLES ================== */
function createParticle(){
  const p=document.createElement("div");
  p.className="particle";
  p.style.left=Math.random()*window.innerWidth+"px";
  p.style.top="60%";
  document.body.appendChild(p);
  setTimeout(()=>p.remove(),800);
}

/* ================== SERVER SYNC ================== */
async function sendToServer(){
  if(!telegramUser) return;
  const ref = doc(db,"players",playerId);
  await setDoc(ref,{
    balance:balance,
    coins:coins,
    premium:premium,
    telegramId:telegramUser.id,
    updated:serverTimestamp()
  },{merge:true});
}

/* ================== GLOBAL LEADERBOARD ================== */
const q = query(collection(db,"players"),orderBy("balance","desc"),limit(5));
onSnapshot(q,(snap)=>{
  leaderboardEl.innerHTML="<h3>ğŸŒ Ğ¢ĞĞŸ 5</h3>";
  snap.forEach(d=>{
    leaderboardEl.innerHTML+=`<div>${d.data().telegramId || d.id} â€” ${d.data().balance.toFixed(2)} $</div>`;
  });
});

/* ================== TOURNAMENT SYSTEM ================== */
const tournamentRef = doc(db,"system","tournament");

async function checkTournament(){
  const snap = await getDoc(tournamentRef);
  let data = snap.data();
  let now = Date.now();

  if(!data || now > data.end){
    await setDoc(tournamentRef,{
      start:now,
      end:now + 10*60*1000,
      prize:50,
      players:[]
    });
  }
}

async function joinTournament(){
  const snap = await getDoc(tournamentRef);
  let data = snap.data();
  if(!data.players.includes(playerId)){
    data.players.push(playerId);
    await updateDoc(tournamentRef,{players:data.players});
    alert("Ğ’Ğ¸ Ğ¿Ñ€Ğ¸Ñ”Ğ´Ğ½Ğ°Ğ»Ğ¸ÑÑ Ğ´Ğ¾ Ñ‚ÑƒÑ€Ğ½Ñ–Ñ€Ñƒ!");
  }
}

async function updateTournamentUI(){
  const snap = await getDoc(tournamentRef);
  const data = snap.data();
  let timeLeft = Math.max(0, data.end - Date.now());

  tournamentEl.innerHTML = `
  ğŸ† Ğ¢ÑƒÑ€Ğ½Ñ–Ñ€ (10 Ñ…Ğ²)<br>
  ĞŸÑ€Ğ¸Ğ·: ${data.prize}$<br>
  Ğ§Ğ°Ñ: ${Math.floor(timeLeft/1000)} ÑĞµĞº<br>
  <button onclick="joinTournament()">Ğ’ÑÑ‚ÑƒĞ¿Ğ¸Ñ‚Ğ¸</button>
  `;

  // ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡Ğ½Ğ° Ğ²Ğ¸Ğ´Ğ°Ñ‡Ğ° Ğ¿Ñ€Ğ¸Ğ·Ñƒ Ğ¿ĞµÑ€ĞµĞ¼Ğ¾Ğ¶Ñ†Ñ
  if(timeLeft<=0 && data.players.length>0){
    let winnerId = data.players[Math.floor(Math.random()*data.players.length)];
    const winnerRef = doc(db,"players",winnerId);
    const winnerSnap = await getDoc(winnerRef);
    let wBal = winnerSnap.data().balance || 0;
    wBal += data.prize;
    await updateDoc(winnerRef,{balance:wBal});
    alert(`ğŸ‰ Ğ¢ÑƒÑ€Ğ½Ñ–Ñ€ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¾! ĞŸĞµÑ€ĞµĞ¼Ğ¾Ğ¶ĞµÑ†ÑŒ: ${winnerId}, Ğ¿Ñ€Ğ¸Ğ· ${data.prize}$`);
    // Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°Ñ”Ğ¼Ğ¾ Ğ½Ğ¾Ğ²Ğ¸Ğ¹ Ñ‚ÑƒÑ€Ğ½Ñ–Ñ€
    await setDoc(tournamentRef,{start:Date.now(),end:Date.now()+10*60*1000,prize:50,players:[]});
  }
}
setInterval(updateTournamentUI,1000);
checkTournament();

/* ================== MULTIPLIERS ================== */
window.activateX2=()=>activateMult(2,10);
window.activateX5=()=>activateMult(5,5);

function activateMult(x,min){
  multiplier=x;
  setTimeout(()=>multiplier=1,min*60000);
}

/* ================== DAILY BONUS ================== */
window.dailyBonus=()=>{
  const today=new Date().toDateString();
  if(localStorage.getItem("daily")==today){alert("Ğ’Ğ¶Ğµ Ğ¾Ñ‚Ñ€Ğ¸Ğ¼Ğ°Ğ½Ğ¾");return;}
  balance+=1;
  localStorage.setItem("daily",today);
  updateUI();
};

/* ================== PREMIUM PAY ================== */
window.buyPremium=()=>{
  if(!telegramUser){alert("Ğ¡Ğ¿Ğ¾Ñ‡Ğ°Ñ‚ĞºÑƒ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·ÑƒĞ¹Ñ‚ĞµÑÑŒ Ñ‡ĞµÑ€ĞµĞ· Telegram"); return;}
  const invoice = {
    title: "TapDay PRO Premium",
    description: "ĞÑ‚Ñ€Ğ¸Ğ¼Ğ°Ğ¹Ñ‚Ğµ x2 Ğ±Ğ¾Ğ½ÑƒÑ Ğ½Ğ°Ğ·Ğ°Ğ²Ğ¶Ğ´Ğ¸",
    payload: "premium_"+playerId,
    provider_token: "YOUR_TELEGRAM_PROVIDER_TOKEN",
    currency: "USD",
    prices: [{label:"Premium Pass",amount:1000}] // $10
  };
  Telegram.WebApp.sendInvoice(invoice);
  premium=true;
  localStorage.setItem("premium","true");
  updateUI();
};

/* ================== DONATE ================== */
window.donateCoins=()=>{
  if(!telegramUser){alert("ĞĞ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·ÑƒĞ¹Ñ‚ĞµÑÑŒ Ñ‡ĞµÑ€ĞµĞ· Telegram"); return;}
  const invoice = {
    title: "TapDay Coins",
    description: "ĞŸÑ€Ğ¸Ğ´Ğ±Ğ°Ğ¹ Ğ¼Ğ¾Ğ½ĞµÑ‚Ğ¸ Ğ´Ğ»Ñ Ğ³Ñ€Ğ¸",
    payload: "donate_"+playerId,
    provider_token: "YOUR_TELEGRAM_PROVIDER_TOKEN",
    currency: "USD",
    prices: [{label:"100 Coins",amount:100}],
  };
  Telegram.WebApp.sendInvoice(invoice);
  coins+=100;
  updateUI();
};

/* ================== SHARE GAME ================== */
const GAME_LINK="https://t.me/tapday_play_bot";
window.shareGame=()=>{
  navigator.clipboard.writeText(GAME_LINK);
  alert("ğŸ”— ĞŸĞ¾ÑĞ¸Ğ»Ğ°Ğ½Ğ½Ñ ÑĞºĞ¾Ğ¿Ñ–Ğ¹Ğ¾Ğ²Ğ°Ğ½Ğ¾!");
};
</script>

<style>
body{margin:0;background:linear-gradient(180deg,#000,#111);font-family:Arial;color:white;text-align:center;}
h1{color:#ffd700;}
#balance,#coins{font-size:28px;margin:15px;}
#tapBtn{width:200px;height:200px;border-radius:50%;background:linear-gradient(45deg,#ff9800,#ffd700);border:none;font-size:30px;box-shadow:0 0 40px gold;}
button{margin:6px;padding:10px 16px;border-radius:10px;border:none;background:#222;color:white;cursor:pointer;}
#leaderboard,#tournament{margin-top:20px;background:#111;padding:10px;}
.particle{position:fixed;width:8px;height:8px;background:gold;border-radius:50%;animation:fly 0.8s linear forwards;}
@keyframes fly{to{transform:translateY(-200px);opacity:0;}}
</style>
</head>
<body>
<h1>ğŸ”¥ TapDay PRO 2026 â€“ Telegram</h1>
<div id="balance">0</div>
<div id="coins">ğŸª™ Coins: 0</div>
<button id="tapBtn">TAP</button>
<br>
<button onclick="activateX2()">âš¡ X2 (10 Ñ…Ğ²)</button>
<button onclick="activateX5()">ğŸ”¥ X5 (5 Ñ…Ğ²)</button>
<button onclick="dailyBonus()">ğŸ Ğ”ĞµĞ½Ğ½Ğ¸Ğ¹ Ğ±Ğ¾Ğ½ÑƒÑ</button>
<button onclick="buyPremium()">ğŸ’ Premium Pass Ñ‡ĞµÑ€ĞµĞ· Telegram</button>
<button onclick="donateCoins()">ğŸ’° ĞšÑƒĞ¿Ğ¸Ñ‚Ğ¸ Coins (Ğ´Ğ¾Ğ½Ğ°Ñ‚)</button>
<button onclick="shareGame()">ğŸ”— ĞŸĞ¾Ğ´Ñ–Ğ»Ğ¸Ñ‚Ğ¸ÑÑ Ğ³Ñ€Ğ¾Ñ</button>

<div id="tournament"></div>
<div id="leaderboard"></div>

<script async src="https://telegram.org/js/telegram-web-app.js"></script>
</body>
</html>
