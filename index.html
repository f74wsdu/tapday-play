const game = {
  money: 100,
  xp: 0,
  energy: 100,
  level: 1,

  buildings: [
    {
      id: "farm",
      name: "Ферма",
      owned: 1,
      baseIncome: 2,
      baseCost: 100,
      timer: 10,
      lastCollect: Date.now()
    }
  ],

  getIncome(building) {
    return building.baseIncome * building.owned;
  },

  getUpgradeCost(building) {
    return Math.floor(building.baseCost * Math.pow(1.6, building.owned));
  },

  collect(buildingId) {
    const b = this.buildings.find(b => b.id === buildingId);
    const now = Date.now();
    const passed = Math.floor((now - b.lastCollect) / 1000);

    if (passed >= b.timer && this.energy > 0) {
      const cycles = Math.floor(passed / b.timer);
      const income = cycles * this.getIncome(b);

      this.money += income;
      this.xp += cycles;
      this.energy -= cycles;

      b.lastCollect = now;
    }
  },

  upgrade(buildingId) {
    const b = this.buildings.find(b => b.id === buildingId);
    const cost = this.getUpgradeCost(b);

    if (this.money >= cost) {
      this.money -= cost;
      b.owned += 1;
    }
  },

  unlockBuilding(building) {
    this.buildings.push(building);
  },

  levelUp() {
    const needXp = this.level * 50;
    if (this.xp >= needXp) {
      this.level++;
      this.energy += 20;

      // відкриття нових будівель
      if (this.level === 3) {
        this.unlockBuilding({
          id: "police",
          name: "Поліцейська станція",
          owned: 0,
          baseIncome: 10,
          baseCost: 1000,
          timer: 20,
          lastCollect: Date.now()
        });
      }

      if (this.level === 6) {
        this.unlockBuilding({
          id: "factory",
          name: "Завод",
          owned: 0,
          baseIncome: 50,
          baseCost: 8000,
          timer: 40,
          lastCollect: Date.now()
        });
      }
    }
  }
};
