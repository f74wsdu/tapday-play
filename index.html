<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TapDay PRO 2026 ‚Äì Telegram Edition</title>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { 
  getFirestore, collection, doc, setDoc, getDoc, updateDoc,
  query, orderBy, limit, onSnapshot, serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

/* ================== FIREBASE CONFIG ================== */
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  projectId: "YOUR_PROJECT",
  storageBucket: "YOUR_PROJECT.appspot.com",
  messagingSenderId: "XXXX",
  appId: "XXXX"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ================== TELEGRAM AUTH ================== */
const TELEGRAM_BOT = "tapday_play_bot"; // —Ç–≤—ñ–π –±–æ—Ç
let telegramUser = JSON.parse(localStorage.getItem("telegramUser")) || null;

async function telegramLogin() {
  if (telegramUser) return;
  // Telegram Login Widget
  const tg = window.Telegram.WebApp || {};
  tg.expand();
  window.TelegramLoginWidget = {
    dataOnauth: function(user){
      telegramUser = user;
      localStorage.setItem("telegramUser",JSON.stringify(user));
      alert(`–ü—Ä–∏–≤—ñ—Ç ${user.first_name}!`);
      initPlayer();
    }
  };
}

telegramLogin();

/* ================== PLAYER INIT ================== */
let playerId = localStorage.getItem("playerId");
if(!playerId){
  playerId = "player_"+Math.floor(Math.random()*9999999);
  localStorage.setItem("playerId",playerId);
}

let balance = parseFloat(localStorage.getItem("balance"))||0;
let multiplier = 1;
let premium = localStorage.getItem("premium")==="true";

const balanceEl = document.getElementById("balance");
const tapBtn = document.getElementById("tapBtn");
const leaderboardEl = document.getElementById("leaderboard");
const tournamentEl = document.getElementById("tournament");

function updateUI(){
  balanceEl.textContent = `üí∞ ${balance.toFixed(2)} $`;
  localStorage.setItem("balance",balance);
}
updateUI();

/* ================== TAP ================== */
tapBtn.onclick = async ()=>{
  balance += 0.01 * multiplier * (premium?2:1);
  updateUI();
  createParticle();
  await sendToServer();
};

/* ================== PARTICLES ================== */
function createParticle(){
  const p=document.createElement("div");
  p.className="particle";
  p.style.left=Math.random()*window.innerWidth+"px";
  p.style.top="60%";
  document.body.appendChild(p);
  setTimeout(()=>p.remove(),800);
}

/* ================== SERVER SYNC ================== */
async function sendToServer(){
  if(!telegramUser) return;
  const ref = doc(db,"players",playerId);
  await setDoc(ref,{
    balance:balance,
    premium:premium,
    telegramId:telegramUser.id,
    updated:serverTimestamp()
  },{merge:true});
}

/* ================== GLOBAL LEADERBOARD ================== */
const q = query(collection(db,"players"),orderBy("balance","desc"),limit(5));
onSnapshot(q,(snap)=>{
  leaderboardEl.innerHTML="<h3>üåç –¢–û–ü 5</h3>";
  snap.forEach(d=>{
    leaderboardEl.innerHTML+=`<div>${d.data().telegramId || d.id} ‚Äî ${d.data().balance.toFixed(2)} $</div>`;
  });
});

/* ================== TOURNAMENT SYSTEM ================== */
const tournamentRef = doc(db,"system","tournament");

async function checkTournament(){
  const snap = await getDoc(tournamentRef);
  let data = snap.data();
  let now = Date.now();

  if(!data || now > data.end){
    await setDoc(tournamentRef,{
      start:now,
      end:now + 10*60*1000,
      prize:50,
      players:[]
    });
  }
}

async function joinTournament(){
  const snap = await getDoc(tournamentRef);
  let data = snap.data();
  if(!data.players.includes(playerId)){
    data.players.push(playerId);
    await updateDoc(tournamentRef,{players:data.players});
    alert("–í–∏ –ø—Ä–∏—î–¥–Ω–∞–ª–∏—Å—è –¥–æ —Ç—É—Ä–Ω—ñ—Ä—É!");
  }
}

async function updateTournamentUI(){
  const snap = await getDoc(tournamentRef);
  const data = snap.data();
  let timeLeft = Math.max(0, data.end - Date.now());
  tournamentEl.innerHTML = `
  üèÜ –¢—É—Ä–Ω—ñ—Ä (10 —Ö–≤)<br>
  –ü—Ä–∏–∑: ${data.prize}$<br>
  –ß–∞—Å: ${Math.floor(timeLeft/1000)} —Å–µ–∫<br>
  <button onclick="joinTournament()">–í—Å—Ç—É–ø–∏—Ç–∏</button>
  `;
}

setInterval(updateTournamentUI,1000);
checkTournament();

/* ================== MULTIPLIERS ================== */
window.activateX2=()=>activateMult(2,10);
window.activateX5=()=>activateMult(5,5);

function activateMult(x,min){
  multiplier=x;
  setTimeout(()=>multiplier=1,min*60000);
}

/* ================== DAILY BONUS ================== */
window.dailyBonus=()=>{
  const today=new Date().toDateString();
  if(localStorage.getItem("daily")==today){alert("–í–∂–µ –æ—Ç—Ä–∏–º–∞–Ω–æ");return;}
  balance+=1;
  localStorage.setItem("daily",today);
  updateUI();
};

/* ================== PREMIUM PAY ================== */
window.buyPremium=()=>{
  if(!telegramUser){alert("–°–ø–æ—á–∞—Ç–∫—É –∞–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å —á–µ—Ä–µ–∑ Telegram"); return;}
  // –í—ñ–¥–∫—Ä–∏–≤–∞—î–º–æ Telegram Payment
  const invoice = {
    title: "TapDay PRO Premium",
    description: "–û—Ç—Ä–∏–º–∞–π—Ç–µ x2 –±–æ–Ω—É—Å –Ω–∞–∑–∞–≤–∂–¥–∏",
    payload: "premium_"+playerId,
    provider_token: "YOUR_TELEGRAM_PROVIDER_TOKEN",
    currency: "USD",
    prices: [{label:"Premium Pass",amount:1000}] // $10
  };
  Telegram.WebApp.sendInvoice(invoice); // WebApp API
};

/* ================== ANTI-CHEAT ================== */
// –¢—É—Ç –º–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ Cloud Functions –¥–ª—è –≤–∞–ª—ñ–¥–∞—Ü—ñ—ó balance/taps
// –î–ª—è –ø—Ä–∏–∫–ª–∞–¥—É, balance –Ω–µ –º–æ–∂–µ –∑—Ä–æ—Å—Ç–∞—Ç–∏ > 0.05$/—Å–µ–∫
</script>

<style>
body{
  margin:0;
  background:linear-gradient(180deg,#000,#111);
  font-family:Arial;
  color:white;
  text-align:center;
}
h1{color:#ffd700;}
#balance{font-size:34px;margin:20px;}
#tapBtn{
  width:200px;height:200px;border-radius:50%;
  background:linear-gradient(45deg,#ff9800,#ffd700);
  border:none;font-size:30px;
  box-shadow:0 0 40px gold;
}
button{
  margin:8px;padding:10px 18px;
  border-radius:10px;border:none;
  background:#222;color:white;
}
#leaderboard,#tournament{
  margin-top:20px;
  background:#111;padding:10px;
}
.particle{
  position:fixed;
  width:8px;height:8px;
  background:gold;
  border-radius:50%;
  animation:fly 0.8s linear forwards;
}
@keyframes fly{
  to{transform:translateY(-200px);opacity:0;}
}
</style>
</head>

<body>

<h1>üî• TapDay PRO 2026 ‚Äì Telegram</h1>
<div id="balance">0</div>
<button id="tapBtn">TAP</button>

<br><br>

<button onclick="activateX2()">‚ö° X2 (10 —Ö–≤)</button>
<button onclick="activateX5()">üî• X5 (5 —Ö–≤)</button>
<button onclick="dailyBonus()">üéÅ –î–µ–Ω–Ω–∏–π –±–æ–Ω—É—Å</button>
<button onclick="buyPremium()">üíé Premium Pass —á–µ—Ä–µ–∑ Telegram</button>

<div id="tournament"></div>
<div id="leaderboard"></div>

<script async src="https://telegram.org/js/telegram-web-app.js"></script>
</body>
</html>
